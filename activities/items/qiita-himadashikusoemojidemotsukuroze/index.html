<!doctypehtml><html lang="ja"><title>zk-phi の部屋 :: 最近の活動</title><meta charset="utf-8"><meta http-equiv="X-UA-Compatible"content="IE=edge"><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="description"content="zk-phi のホームページです"><link rel="stylesheet"href="/css/font.css"><link rel="stylesheet"href="/css/common_critical.css"><link rel="stylesheet"href="/css/activity.css"><script defer src="/js/loader.js"></script><style></style><body id="body"class="dotgothic"><div id="content"><h1 id="title"><span class="rot">💻</span>最近の活動<span class="rot">💻</span></h1><p><a class="link"href="javascript:history.back()">&lt; 戻る</a><hr><div id="article"class="left"><h2 class="header">暇だしクソ絵文字でも作ろうぜ！</h2><div class="right"><p>Qiita (2020/4/12)<a class="link"target="_blank"rel="noreferrer"href="https://qiita.com/zk_phi/items/6b3e74bd6f892a3b408c">See original</a></div><div id="cdata"><h2>何をやったの</h2><p>Unicode 絵文字のいろんなパーツをごちゃ混ぜにして、クソ絵文字を錬成できるツールを作りました。<p>暇つぶしや、チャットでの小ボケにドウゾ。こんな時代だしリモートを楽しもうぜ。<p>https://zk-phi.github.io/MEGAMOJI?mode=fukumoji (4/13 更新: MEGAMOJI に統合しました)<p>&lt;img width=&quot;1295&quot; alt=&quot;スクリーンショット 2020-04-12 15.30.40.png&quot; src=&quot;https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/54240/a7d65d52-845f-1491-a228-46c7f744db9a.png&quot;&gt;<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/54240/ad5d8ab4-4519-33aa-3579-70e39133e5d9.gif"alt="emoji.gif"><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/54240/ad5d8ab4-4519-33aa-3579-70e39133e5d9.gif"alt="emoji.gif"><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/54240/ad5d8ab4-4519-33aa-3579-70e39133e5d9.gif"alt="emoji.gif"><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/54240/ad5d8ab4-4519-33aa-3579-70e39133e5d9.gif"alt="emoji.gif"><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/54240/ad5d8ab4-4519-33aa-3579-70e39133e5d9.gif"alt="emoji.gif"><h3>きっかけ</h3><p>Emoji Mashup Bot https://twitter.com/emojimashupbot がときどき放つ会心の一撃が好きすぎたので、自分で作ってみたいなと思いました。<p>それっぽいツールは既存でもいくつかあるのですが、オープンソースのものがなかったり、権利が怪しかったり (iOS の絵文字がベースになってそうなパーツがある etc) したので、権利的にも UI 的にもシンプルなものを自前実装してみました。<h2>実装</h2><p>実装上の知見などを簡単に紹介します。<h3>使いやすい絵文字素材</h3><p>権利がクリアかつ扱いやすい絵文字画像が必要なのですが、 Twitter 社の OSS Twemoji がとても便利でした。<p>https://twemoji.twitter.com/<p>画像は CC-BY 、コードは MIT でライセンスされていて、自分の理解が正しければ、権利表示さえすれば自由に改変して使用することができます。<p>&lt;img width=&quot;308&quot; alt=&quot;スクリーンショット 2020-04-12 15.46.43.png&quot; src=&quot;https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/54240/c006daae-d51b-c324-7beb-56e107d32003.png&quot;&gt;<p>形式も SVG になっていて、イラレなどで簡単にパーツを抜き出せるのでかなり使いやすいです。<h3>保存できる画像を生成する</h3><p>たんに福笑いを表示するだけなら、<code>img</code>を<code>position: absolute</code>して重ねるなどすればよいのですが、絵文字として使ってもらうためには、ちゃんと右クリックで保存できるようにしてあげたいところです。<p>自分のツールでは、すべての画像を１枚の<code>canvas</code>要素に合成することで１枚の保存できる画像を生成しています。<pre><code class="language-javascript">// パーツ画像の url リスト -&gt; 合成された画像の url
function (items) {
  var canvas = document.createElement(&quot;canvas&quot;);
  var ctx = canvas.getContext('2d');

  canvas.width = EMOJI_SIZE;
  canvas.height = EMOJI_SIZE;

  var img = document.createElement(&quot;img&quot;);
  for (var item of items) {
    img.src = item;
    ctx.drawImage(img, 0, 0, EMOJI_SIZE, EMOJI_SIZE);
  }

  return canvas.toDataURL();
}
</code></pre><p>上のコードで、各パーツの画像はすでに一度ロードされている想定になっているところだけ注意が必要です。まだロードされていない画像ファイルを使う場合は、以下のようにロードを待つ必要があり、めでたくコールバック地獄となります。<pre><code class="language-javascript">img.onload = function () {
  ctx.drawImage(img, 0, 0, EMOJI_SIZE, EMOJI_SIZE);
};
img.src = item;
</code></pre><h2>まとめ</h2><p>みんなもクソコラ絵文字で遊ぼう！面白い絵文字を錬成したら教えてくれよな</div></div><hr><p><a class="link"href="javascript:history.back()">&lt; 戻る</a></div><script>const lazyScripts=["/js/prefetch.js","/js/stalker.js","/js/activity.js"],lazyStyles=["/css/common.css","/css/stalker.css"],prefetches=[]</script>