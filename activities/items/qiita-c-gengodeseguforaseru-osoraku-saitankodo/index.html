<!doctypehtml><html lang="ja"><title>zk-phi の部屋 :: 最近の活動</title><meta charset="utf-8"><meta name="viewport"content="initial-scale=1"><meta name="description"content="zk-phi のホームページです"><link rel="preload"href="/fonts/DotGothic16-Regular.woff2"as="font"crossorigin><link rel="stylesheet"href="/css/font.css"><link rel="stylesheet"href="/css/common_critical.css"><link rel="stylesheet"href="/css/activity.css"><script defer src="/js/loader.js"></script><script defer src="/js/bg.js"></script><style></style><body id="body"><canvas id="bg"></canvas><div id="content"><h1 id="title"><span class="rot">💻</span>最近の活動<span class="rot">💻</span></h1><p><a class="link"href="javascript:history.back()">&lt; 戻る</a><hr><div id="article"class="left"><h2>C 言語でセグフォらせる (おそらく) 最短コード</h2><div class="right"><p>Qiita (2020/7/2)<a class="link"target="_blank"rel="noreferrer"href="https://qiita.com/zk_phi/items/bd59111e677e6d0e5720">See original</a></div><div id="cdata"><p>セグフォブームに便乗して。多分これが一番短いんじゃないかな？というのを昔調べたことがありました。<p>結論からいくと、 GCC は<code>main</code>シンボルが宣言されていればとりあえず実行ファイルを生成できます。<p>宣言時の型は省略できる (暗黙に<code>int</code>になる) ので、<code>main;</code>とだけ書いておけばとりあえず<code>main</code>シンボルを宣言できます。したがって以下の５文字でとりあえず実行ファイルを作ることができます。<pre><code class="language-C:segfault.c">main;
</code></pre><pre><code class="language-terminal">$ gcc segfault.c 
segfault.c:1:1: warning: data definition has no type or storage class
 main;
 ^~~~
segfault.c:1:1: warning: type defaults to 'int' in declaration of 'main' [-Wimplicit-int]
</code></pre><p>実行すると<code>main</code>関数を呼び出そうとしますが、もちろんまともな実体がないので死にます (「<code>main</code>らしきもの」を<code>call</code>した次のステップで、変な命令を踏んで死)。<pre><code class="language-terminal">$ ./a.out 
Segmentation fault
</code></pre><p>ちなみに<code>main</code>シンボルすら定義しない空のプログラムも、 C のプログラムとしては valid なのでコンパイルまではできるみたいです。ただし実行ファイルを作ろうとするとリンカが死ぬので、実行はできません。<pre><code class="language-C:kyomu.c"></code></pre><pre><code class="language-terminal">$ gcc -c kyomu.c # コンパイルはできる
</code></pre><pre><code class="language-terminal">$ gcc kyomu.c # リンクはできない
/usr/lib/gcc/x86_64-redhat-linux/7/../../../../lib64/crt1.o: In function `_start':
(.text+0x20): undefined reference to `main'
collect2: error: ld returned 1 exit status
</code></pre><hr><p>追記: 「16文字」の記事のコメント欄で同じアイデアが先に言及されてました 🙏 おもしろいと思ったらぜひそちらにいいねお願いします！</div></div><hr><p><a class="link"href="javascript:history.back()">&lt; 戻る</a></div><script>const lazyScripts=["/js/prefetch.js","/js/stalker.js","/js/activity.js"],lazyStyles=["/css/common.css","/css/stalker.css"]</script>